services:
  hms.authentication.token:
    class: Drupal\hms\Authentication\Provider\SsoCookie
    arguments:
      - @hms.client
      - @hms.settings
      - @hms.logger
      - @hms.response_subscriber.clear_invalid_cookie
      - @cache.hms
      - @user.data
      - @entity_type.manager
      - @session_configuration
    tags:
      - name: authentication_provider
        provider_id: hms_token
        priority: 100
        global: true

  hms.client:
    class: Drupal\hms\Client\Harbourmaster
    arguments:
      - @hms.http_client
      - @hms.settings

  # disable http status exceptions b/c they are excepted and handled via status code
  hms.http_client:
    class: GuzzleHttp\ClientInterface
    factory: http_client_factory:fromOptions
    arguments:
      - http_errors: false

  hms.logger:
    parent: logger.channel_base
    arguments:
      - hms

  hms.settings:
    class: Drupal\Core\Config\ImmutableConfig
    factory: config.factory:get
    arguments:
      - hms.settings

  cache.hms:
    class: Drupal\Core\Cache\CacheBackendInterface
    tags:
    - { name: cache.bin }
    factory: cache_factory:get
    arguments:
      - hms

  hms.page_cache_request_policy.disallow_token_requests:
    class: Drupal\hms\PageCache\DisallowTokenRequests
    public: false
    tags:
      - { name: page_cache_request_policy }
    arguments:
      - @hms.settings

  hms.response_subscriber.clear_invalid_cookie:
    class: Drupal\hms\EventSubscriber\ClearInvalidTokenCookie
    arguments:
      - @hms.settings
    tags:
      - { name: 'event_subscriber' }