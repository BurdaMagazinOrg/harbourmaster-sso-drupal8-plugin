# TODO mark private services

services:
  hms.authentication.token:
    class: Drupal\hms\Authentication\Provider\SsoCookie
    arguments:
      - @hms.client
      - @hms.settings
      - @hms.user_manager
      - @hms.cookie_helper
      - @cache.hms
      - @session
      - @session_configuration
      - @session_manager
      - @database
    calls:
      - ['setLogger', [%hms.logger.service%]]
    tags:
      - name: authentication_provider
        provider_id: hms_token
        priority: 100
        global: true

  hms.user_manager:
    class: Drupal\hms\User\Manager
    arguments:
      - @user.data
      - @entity_type.manager
      - %hms.adapter.service%
    calls:
      - ['setLogger', [%hms.logger.service%]]

  hms.client:
    class: Drupal\hms\Client\Harbourmaster
    arguments:
      - @hms.http_client
      - @hms.settings
    calls:
      - ['setLogger', [%hms.logger.service%]]

  # disable http status exceptions b/c they are expected and handled via status code
  hms.http_client:
    class: GuzzleHttp\ClientInterface
    factory: http_client_factory:fromOptions
    arguments:
      - http_errors: false
        verify: false

  hms.logger:
    parent: logger.channel_base
    arguments:
      - hms

  hms.settings:
    class: Drupal\Core\Config\ImmutableConfig
    factory: config.factory:get
    arguments:
      - hms.settings

  cache.hms:
    class: Drupal\Core\Cache\CacheBackendInterface
    tags:
    - { name: cache.bin }
    factory: cache_factory:get
    arguments:
      - hms

  hms.page_cache_request_policy.disallow_token_requests:
    class: Drupal\hms\PageCache\DisallowTokenRequests
    public: false
    tags:
      - { name: page_cache_request_policy }
    arguments:
      - @hms.settings

  hms.default_user_adapter:
    class: Drupal\hms\User\DefaultUserAdapter
    arguments:
      - @hms.settings
      - @entity_type.manager
    calls:
      - ['setLogger', [%hms.logger.service%]]

  hms.cookie_helper:
    public: false
    class: Drupal\hms\Helper\CookieHelper
    arguments:
      - @hms.settings
    tags:
      - { name: 'event_subscriber' }

parameters:
  hms.adapter.service: @hms.default_user_adapter
  hms.logger.service: @hms.logger